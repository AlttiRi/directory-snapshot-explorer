import{r as e,c as t,w as n,m as a,i as s,t as o,u as l,p as r,a as i,o as c,b as u,d,e as p,f,g as v,h,n as m,j as y,k as g,F as w,l as k,q as b,s as S,v as D,x as _,y as x,z as M,A as T,B as j}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&processPreload(e)})).observe(document,{childList:!0,subtree:!0})}function processPreload(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const C=globalThis.setImmediate||function(){const{port1:e,port2:t}=new MessageChannel,n=[];return e.onmessage=function(){n.shift()()},function(e){t.postMessage(null),n.push(e)}}();function sleep(e){return new Promise(void 0===e?e=>C(e):t=>setTimeout(t,e))}const E=["mp4","webm","mkv","avi"];const I=["png","jpg","jpeg","gif","tiff","webp"];function dateToDayDateString(e,t=!0){const n=new Date(e);function pad(e){return e.toString().padStart(2,"0")}const a=t?"UTC":"",s=n[`get${a}FullYear`](),o=n[`get${a}Month`]()+1,l=n[`get${a}Date`]();return 0===Number(n)?(console.warn("date is 1970.01.01"),""):s+"."+pad(o)+"."+pad(l)}const $=e(!0),{compare:N}=new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"});function comparator(e,t){return $.value?N(e.name,t.name):0}const P=t((()=>[...K.value.folders.sort(comparator),...K.value.files.sort(comparator),...K.value.symlinks.sort(comparator),...K.value.fifos.sort(comparator),...K.value.charDevs.sort(comparator),...K.value.blockDevs.sort(comparator),...K.value.sockets.sort(comparator)])),F=t((()=>A.value.length?B.value:P.value)),O=t((()=>F.value.slice(0,1e3))),J=t((()=>B.value.length>1e3?B.value.length:F.value.length)),R=e("");function addMessage(e){R.value=e}function appendMessage(e){R.value+=e}const Z=["folder","file","symlink","fifo","charDev","blockDev","socket"];class SimpleEntry{constructor(e,t){this.name=e.name,this.parent=t,this.type=e.type,e.size&&(this._size=e.size),e.mtime&&(this.mtime=e.mtime),e.btime&&(this.btime=e.btime),e.errors&&(this.errors=e.errors),e.pathTo&&(this.pathTo=e.pathTo),e.content&&(this.content=e.content)}addChild(e){this.children||(this.children=[]),this.children.push(e)}addHardlinks(e,t){this.hardlinks=e,this.hardlinksTotal=t}get size(){return"folder"===this.type?-0:this._size||0}get folders(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"folder"===e.type)))||[]}get files(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"file"===e.type)))||[]}get symlinks(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"symlink"===e.type)))||[]}get fifos(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"fifo"===e.type)))||[]}get charDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"charDev"===e.type)))||[]}get blockDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"blockDev"===e.type)))||[]}get sockets(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"socket"===e.type)))||[]}get isEmpty(){var e;return!Boolean(null==(e=this.children)?void 0:e.length)}get hasErrors(){var e;return Boolean(null==(e=this.errors)?void 0:e.length)}get root(){return this.parent?this.parent.root:this}get path(){return this.parent?[...this.parent.path,this]:[this]}}async function parseFlatScan(e){var t;const n=new Map,a=new Map;let s=0,o=Date.now();for(const l of e){if(!(s++%1e3)){const e=Date.now();e-o>15&&(o=e,await sleep())}const e=null!=(t=n.get(l.pid))?t:null,r=new SimpleEntry(l,e);if("folder"===l.type&&n.set(l.id,r),null==e||e.addChild(r),l.hid){const e=a.get(l.hid)||[];a.set(l.hid,[...e,r])}}return console.log("[hidMap]:",a),console.time("hidMap"),async function(e){let t=0,n=0;for(const[a,s]of e.entries()){if(!(t++%1e3)){const e=Date.now();e-n>15&&(n=e,await sleep())}const e=Number(a.split(":")[1]);s.forEach((t=>{t.addHardlinks(s,e)}))}}(a).then((()=>console.timeEnd("hidMap"))),n.get(0)}const z=new SimpleEntry({type:"folder",name:"",pid:null},null),A=e("");function clearSearch(){A.value=""}const B=e([]);function setSearchResult(e){B.value=a(e),console.log("globalThis.search:",globalThis.search=e),Object.defineProperty(globalThis.search,"download",{get(){console.log("download")}})}const G=function(e,t=50){let n;return function(){n&&clearTimeout(n),n=setTimeout((()=>{e.apply(this,arguments),n=null}),t)}}(performSearch,300);async function performSearch(){const e=K.value,t=A.value,n=s(e)?o(e):e,a=performance.now(),l=await async function(e,t){var n;if(!t.startsWith("/"))return findAll(e,(e=>e.name.includes(t)));{const{type:a,word:s}=(null==(n=t.match(/\/type:(?<type>[^\/]+)\/?(?<word>[^\/]*)/))?void 0:n.groups)||{};if(a&&(console.log({type:a,word:s}),Z.includes(a)))return findAll(e,(e=>e.type===a&&e.name.includes(s)))}return!1}(n,t);if(!l)return;addMessage(`Search time: ${(performance.now()-a).toFixed(2)} ms; `),await sleep();const r=performance.now(),i=l.sort(comparator);appendMessage(`Sort time: ${(performance.now()-r).toFixed(2)} ms; `),await sleep(),setSearchResult(i),appendMessage(`${l.length} items; search: ${t}`)}async function findAll(e,t){let n=[],a=Date.now();for(const s of function*(e){const t=1e3;let n=[];function*takePart(e){for(const a of e.children||[])"folder"===a.type&&(yield*takePart(a)),n.push(a),n.length===t&&(yield n,n=[])}yield*takePart(e),yield n}(e)){const e=Date.now();e-a>15&&(a=e,await sleep());for(const a of s)t(a)&&n.push(a)}return n}n(A,(async(e,t)=>{e?e.length-t.length>1?await performSearch():await G():setSearchResult([])}));let L=!1;async function loadPako(){if(!L){const e="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako_inflate.min.js",t="sha256-ZIKs3+RZEULSy0dR6c/mke8V9unZm9vuh05TqvtMdGU=";await function(e,t){return new Promise((n=>{const a=document.createElement("script");a.onload=n,a.src=e,a.setAttribute("async",""),t&&(a.integrity=t,a.setAttribute("crossorigin","anonymous")),document.querySelector("body").append(a)}))}(e,t),L=!0,console.log("pako is loaded")}}async function unGZipJSON(e){await loadPako();const t=new pako.Inflate,n=await e.arrayBuffer();return t.push(n),t.err&&console.error(t.msg),JSON.parse((new TextDecoder).decode(t.result))}function isGZip(e){return Boolean(e.match(/^application\/.*?gzip/))}function isJSON(e){return Boolean(e.match(/^application\/.*?json/))}const U=e(null),W=e(null);async function setScan(e){const{meta:t,root:n}=await async function(e){let t;if(e instanceof Response){const n=e,a=n.headers.get("content-type");isGZip(a)?t=await unGZipJSON(n):isJSON(a)&&(t=await n.json())}else if(e instanceof Blob){const n=e;isGZip(n.type)?t=await unGZipJSON(n):isJSON(n.type)&&(t=JSON.parse(await n.text()))}const n=t[0],a=t.slice(1);console.time("parseEntries");const s=await parseFlatScan(a);return console.timeEnd("parseEntries"),{meta:n,root:s}}(e);U.value=a(t),W.value=a(n),globalThis.json=n,openFolder(n),clearSearch()}const q=t((()=>{var e;return(null==(e=U.value)?void 0:e.separator)||"/"})),H=t((()=>{var e;return(null==(e=U.value)?void 0:e.path)||[]})),K=e(z),V=t((()=>K.value.path));function openFolder(e){clearSearch(),K.value=a(l(e))}const Y=t((()=>W.value&&K.value.isEmpty));n(U,(async(e,t)=>{console.log("[meta]:",U.value);const{files:n,folders:a,symlinks:s,errors:o,total:l,scanDate:r}=U.value;U.value.scanDate&&addMessage(`files: "${n}" folders: "${a}", symlinks: "${s}", errors: "${o}", total: "${l}", scanDate: "${dateToDayDateString(r)}"`)}));r("data-v-48cc0cd2");const Q={class:"scanPath"},X=["title"],ee={class:"part"},te={class:"part spaced"},ne={key:0,class:"spaced separator"};i();const ae={setup(e){const n=t((()=>{if(!U.value)return;const{files:e,folders:t,symlinks:n,charDevs:a,blockDevs:s,fifos:o,sockets:l,total:r,platform:i,scanDate:c}=U.value;function doString(e){return Object.entries(e).map((([e,t])=>function(e){const t=3-Math.trunc(e.length/4);return e+"\t".repeat(t)}(e)+": "+t)).join("\n")}const u=doString({files:e,folders:t,symlinks:n}),d=doString({charDevs:a,blockDevs:s,fifos:o,sockets:l}),p=doString({total:r,platform:i,scanDate:dateToDayDateString(c)});let f;return f="win32"!==i?[u,d,p].join("\n"):[u,p].join("\n"),console.log(f),f})),a=t((()=>{const e=[...H.value,K.value.root.name].join(q.value);return e.startsWith("//")?e.slice(1):e})),s=t((()=>[...a.value].slice(0,-1).join(""))),o=t((()=>[...a.value].slice(-1).join(""))),r=t((()=>V.value.length-1&&"/"!==a.value));function goToRoot(){openFolder(K.value.root)}return(e,t)=>(c(),u("span",Q,[d("span",{class:"parts",onClick:goToRoot,title:l(n)},[d("span",ee,p(l(s)),1),d("span",te,p(l(o)),1)],8,X),l(r)?(c(),u("span",ne,p(l(q)),1)):f("",!0)]))},__scopeId:"data-v-48cc0cd2"};r("data-v-44b3de2e");const se={class:"opened-folder"},oe={class:"part"},le={class:"part spaced"},re={key:0,class:"separator spaced"};i();const ie={props:["index","count","entry"],setup(e){const n=e,{index:a,count:s,entry:o}=v(n),r=t((()=>a.value+1===s.value)),i=t((()=>[...o.value.name].slice(0,-1).join(""))),h=t((()=>[...o.value.name].slice(-1).join("")));function onClick(){openFolder(o.value)}return(e,t)=>(c(),u("span",se,[d("span",{class:"parts",onClick:onClick},[d("span",oe,p(l(i)),1),d("span",le,p(l(h)),1)]),l(r)?f("",!0):(c(),u("span",re,p(l(q)),1))]))},__scopeId:"data-v-44b3de2e"};r("data-v-f8be0ec4");const ce={class:"box"};i();const ue={props:{maxWidth:{default:"max-content",type:String}},setup:e=>(t,n)=>(c(),u("div",ce,[d("div",{class:"sub",style:m({maxWidth:e.maxWidth})},[h(t.$slots,"default",{},void 0,!0)],4)])),__scopeId:"data-v-f8be0ec4"};r("data-v-55c28eea");const de={class:"address"};i();const pe={setup:e=>(e,t)=>(c(),u("div",de,[y(ue,null,{default:g((()=>[y(ae)])),_:1}),(c(!0),u(w,null,k(l(V).slice(1),((e,t)=>(c(),b(ue,null,{default:g((()=>[y(ie,{entry:e,index:t,count:l(V).slice(1).length},null,8,["entry","index","count"])])),_:2},1024)))),256))])),__scopeId:"data-v-55c28eea"};r("data-v-35dc98f8");const fe={class:"search"};i();const ve={setup:e=>(e,t)=>(c(),u("div",fe,[d("label",null,[S(d("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>_(A)?A.value=e:null)},null,512),[[D,l(A)]])]),d("button",{onClick:t[1]||(t[1]=(...e)=>l(clearSearch)&&l(clearSearch)(...e))},"Clear")])),__scopeId:"data-v-35dc98f8"};r("data-v-23a29b76");const he={class:"file-select"},me=x(" Select file "),ye=d("hr",null,null,-1);i();const ge={setup(e){function onChange(e){return setScan(e.target.files[0])}return(e,t)=>(c(),u("div",he,[d("label",null,[me,d("input",{type:"file",accept:"application/json,application/gzip",onChange:onChange},null,32)]),ye]))},__scopeId:"data-v-23a29b76"};r("data-v-4cf83322");const we={class:"tabs"},ke=d("div",{class:"tab"},null,-1);i();const be={setup:e=>(e,t)=>(c(),u("div",we,[y(ge,{class:"tab"}),ke])),__scopeId:"data-v-4cf83322"};r("data-v-e9f0ab3e");const Se=["title"],De={class:"icon"},_e={class:"name"};i();const xe={props:["entry"],setup(e){const n=v(e).entry,a=t((()=>n.value.hasErrors)),s=t((()=>n.value.hasErrors?JSON.stringify(n.value.errors[0],null," "):"symlink"===n.value.type?n.value.pathTo:void 0)),o=t((()=>"folder"===n.value.type?"📁":"file"===n.value.type?function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return E.includes(t)}(n.value.name)?"🎦":function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return I.includes(t)}(n.value.name)?"🖼":"📄":"symlink"===n.value.type?"🔗":"👾"));function onClick(e){"folder"===n.value.type?(console.log("openFolder",n.value),openFolder(n.value)):console.log(n.value)}function onMousedown(e){1===e.button&&(e.preventDefault(),console.log(n.value,[...U.value.path,...n.value.path.map((e=>e.name))].join(q.value).replace("//","/")))}return(e,t)=>(c(),u("tr",{class:M(["row",{error:l(a)}]),onClick:onClick,onMousedown:onMousedown,title:l(s)},[d("td",De,p(l(o)),1),d("td",_e,p(l(n).name),1)],42,Se))},__scopeId:"data-v-e9f0ab3e"};r("data-v-47520d98");const Me={key:0,class:"rows"},Te={key:1,class:"empty-message"},je=[d("span",null,"The folder is empty.",-1)],Ce={key:2,class:"error-message"},Ee=d("h2",null,"Error",-1),Ie=d("td",null,"syscall",-1),$e=d("td",null,"code",-1),Ne=d("td",null,"errno",-1);i();const Pe={setup(e){const n=t((()=>!!K.value.hasErrors&&K.value.errors[0]));function onContextMenu(e){e.preventDefault(),K.value.parent&&openFolder(K.value.parent)}return(e,t)=>(c(),u("div",{class:"content",onContextmenu:onContextMenu},[l(O).length?(c(),u("table",Me,[(c(!0),u(w,null,k(l(O),(e=>(c(),b(xe,{entry:e},null,8,["entry"])))),256))])):f("",!0),l(Y)&&!l(n)?(c(),u("div",Te,je)):f("",!0),l(n)?(c(),u("div",Ce,[d("div",null,[Ee,d("table",null,[d("tr",null,[Ie,d("td",null,[d("pre",null,p(l(n).syscall),1)])]),d("tr",null,[$e,d("td",null,[d("pre",null,p(l(n).code),1)])]),d("tr",null,[Ne,d("td",null,[d("pre",null,p(l(n).errno),1)])])])])])):f("",!0)],32))},__scopeId:"data-v-47520d98"},Fe={setup:e=>(e,t)=>(c(),u("div",null,"Item count: "+p(l(J)),1))},Oe={key:0},Je={key:1},Re={setup:e=>(e,t)=>l(R)?(c(),u("span",Oe,p(l(R)),1)):(c(),u("span",Je,"_"))};r("data-v-602ec060");const Ze={class:"main"},ze=d("div",{style:{"grid-area":"switch"}},null,-1);i();const Ae={setup:e=>(T((async()=>{const e=new URL(location.href).searchParams.get("filepath");if(e){return setScan(await fetch(e))}})),(e,t)=>(c(),u("div",Ze,[ze,y(pe,{style:{"grid-area":"address"}}),y(ve,{style:{"grid-area":"search"}}),y(be,{style:{"grid-area":"tabs"}}),y(Pe,{style:{"grid-area":"content"}}),y(Fe,{style:{"grid-area":"status"}}),y(Re,{style:{"grid-area":"debug"}})]))),__scopeId:"data-v-602ec060"};j({setup:e=>(e,t)=>(c(),b(Ae))}).mount("#app");
//# sourceMappingURL=index.js.map
