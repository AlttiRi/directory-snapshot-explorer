import{r as e,c as t,w as n,m as s,i as a,t as l,u as o,p as r,a as i,o as c,b as u,d,e as p,f,g as v,h,n as m,j as y,k as g,F as w,l as b,q as k,s as _,v as D,x as j,y as x,z as E,A as T,B as I}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const $=globalThis.setImmediate||function(){const{port1:e,port2:t}=new MessageChannel,n=[];return e.onmessage=function(){n.shift()()},function(e){t.postMessage(null),n.push(e)}}();function S(e){return new Promise(void 0===e?e=>$(e):t=>setTimeout(t,e))}const C=["mp4","webm","mkv","avi"];const M=["png","jpg","jpeg","gif","tiff","webp"];function z(e,t=!0){const n=new Date(e);function s(e){return e.toString().padStart(2,"0")}const a=t?"UTC":"",l=n[`get${a}FullYear`](),o=n[`get${a}Month`]()+1,r=n[`get${a}Date`]();return 0===Number(n)?(console.warn("date is 1970.01.01"),""):l+"."+s(o)+"."+s(r)}const N=e(!0),{compare:B}=new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"});function L(e,t){return N.value?B(e.name,t.name):0}const O=t((()=>[...ue.value.folders.sort(L),...ue.value.files.sort(L),...ue.value.symlinks.sort(L),...ue.value.fifos.sort(L),...ue.value.charDevs.sort(L),...ue.value.blockDevs.sort(L),...ue.value.sockets.sort(L)])),P=t((()=>H.value.length?V.value:O.value)),F=t((()=>P.value.slice(0,1e3))),U=t((()=>V.value.length>1e3?V.value.length:P.value.length)),W=e("");function q(e){W.value=e}function A(e){W.value+=e}const R=["folder","file","symlink","fifo","charDev","blockDev","socket"];class SimpleEntry{constructor(e,t){this.name=e.name,this.parent=t,this.type=e.type,e.size&&(this._size=e.size),e.mtime&&(this.mtime=e.mtime),e.btime&&(this.btime=e.btime),e.errors&&(this.errors=e.errors),e.pathTo&&(this.pathTo=e.pathTo),e.content&&(this.content=e.content)}addChild(e){this.children||(this.children=[]),this.children.push(e)}addHardlinks(e,t){this.hardlinks=e,this.hardlinksTotal=t}get size(){return"folder"===this.type?-0:this._size||0}get folders(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"folder"===e.type)))||[]}get files(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"file"===e.type)))||[]}get symlinks(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"symlink"===e.type)))||[]}get fifos(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"fifo"===e.type)))||[]}get charDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"charDev"===e.type)))||[]}get blockDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"blockDev"===e.type)))||[]}get sockets(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"socket"===e.type)))||[]}get isEmpty(){var e;return!Boolean(null==(e=this.children)?void 0:e.length)}get hasErrors(){var e;return Boolean(null==(e=this.errors)?void 0:e.length)}get root(){return this.parent?this.parent.root:this}get path(){return this.parent?[...this.parent.path,this]:[this]}}async function J(e){var t;const n=new Map,s=new Map;for(const a of e){const e=null!=(t=n.get(a.pid))?t:null,l=new SimpleEntry(a,e);if("folder"===a.type&&n.set(a.id,l),null==e||e.addChild(l),a.hid){const e=s.get(a.hid)||[];s.set(a.hid,[...e,l])}}return console.log("[hidMap]:",s),console.time("hidMap"),async function(e){let t=0,n=0;for(const[s,a]of e.entries()){if(!(t++%1e3)){const e=Date.now();e-n>15&&(n=e,await S())}const e=Number(s.split(":")[1]);a.forEach((t=>{t.addHardlinks(a,e)}))}}(s).then((()=>console.timeEnd("hidMap"))),n.get(0)}const Z=new SimpleEntry({type:"folder",name:"",pid:null},null),H=e("");function K(){H.value=""}const V=e([]);function G(e){V.value=s(e),console.log("globalThis.search:",globalThis.search=e),Object.defineProperty(globalThis.search,"download",{get(){console.log("download")}})}const Y=function(e,t=50){let n;return function(){n&&clearTimeout(n),n=setTimeout((()=>{e.apply(this,arguments),n=null}),t)}}(Q,300);async function Q(){const e=ue.value,t=H.value,n=a(e)?l(e):e,s=performance.now(),o=await async function(e,t){var n;if(!t.startsWith("/"))return X(e,(e=>e.name.includes(t)));{const{type:s,word:a}=(null==(n=t.match(/\/type:(?<type>[^\/]+)\/?(?<word>[^\/]*)/))?void 0:n.groups)||{};if(s&&(console.log({type:s,word:a}),R.includes(s)))return X(e,(e=>e.type===s&&e.name.includes(a)))}return!1}(n,t);if(!o)return;q(`Search time: ${(performance.now()-s).toFixed(2)} ms; `),await S();const r=performance.now(),i=o.sort(L);A(`Sort time: ${(performance.now()-r).toFixed(2)} ms; `),await S(),G(i),A(`${o.length} items; search: ${t}`)}async function X(e,t){let n=[],s=Date.now();for(const a of function*(e){const t=1e3;let n=[];function*s(e){for(const a of e.children||[])"folder"===a.type&&(yield*s(a)),n.push(a),n.length===t&&(yield n,n=[])}yield*s(e),yield n}(e)){const e=Date.now();e-s>15&&(s=e,await S());for(const s of a)t(s)&&n.push(s)}return n}n(H,(async(e,t)=>{e?e.length-t.length>1?await Q():await Y():G([])}));let ee=!1;async function te(){if(!ee){const e="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako_inflate.min.js",t="sha256-ZIKs3+RZEULSy0dR6c/mke8V9unZm9vuh05TqvtMdGU=";await function(e,t){return new Promise((n=>{const s=document.createElement("script");s.onload=n,s.src=e,s.setAttribute("async",""),t&&(s.integrity=t,s.setAttribute("crossorigin","anonymous")),document.querySelector("body").append(s)}))}(e,t),ee=!0,console.log("pako is loaded")}}async function ne(e){await te();const t=new pako.Inflate,n=await e.arrayBuffer();return t.push(n),t.err&&console.error(t.msg),JSON.parse((new TextDecoder).decode(t.result))}function se(e){return Boolean(e.match(/^application\/.*?gzip/))}function ae(e){return Boolean(e.match(/^application\/.*?json/))}const le=e(null),oe=e(null);async function re(e){const{meta:t,root:n}=await async function(e){let t;if(e instanceof Response){const n=e,s=n.headers.get("content-type");se(s)?t=await ne(n):ae(s)&&(t=await n.json())}else if(e instanceof Blob){const n=e;se(n.type)?t=await ne(n):ae(n.type)&&(t=JSON.parse(await n.text()))}const n=t[0],s=t.slice(1);console.time("parseEntries");const a=await J(s);return console.timeEnd("parseEntries"),{meta:n,root:a}}(e);le.value=s(t),oe.value=s(n),globalThis.json=n,pe(n),K()}const ie=t((()=>{var e;return(null==(e=le.value)?void 0:e.separator)||"/"})),ce=t((()=>{var e;return(null==(e=le.value)?void 0:e.path)||[]})),ue=e(Z),de=t((()=>ue.value.path));function pe(e){K(),ue.value=s(o(e))}const fe=t((()=>oe.value&&ue.value.isEmpty));n(le,(async(e,t)=>{console.log("[meta]:",le.value);const{files:n,folders:s,symlinks:a,errors:l,total:o,scanDate:r}=le.value;le.value.scanDate&&q(`files: "${n}" folders: "${s}", symlinks: "${a}", errors: "${l}", total: "${o}", scanDate: "${z(r)}"`)}));r("data-v-48cc0cd2");const ve={class:"scanPath"},he=["title"],me={class:"part"},ye={class:"part spaced"},ge={key:0,class:"spaced separator"};i();const we={setup(e){const n=t((()=>{if(!le.value)return;const{files:e,folders:t,symlinks:n,charDevs:s,blockDevs:a,fifos:l,sockets:o,total:r,platform:i,scanDate:c}=le.value;function u(e){return Object.entries(e).map((([e,t])=>function(e){const t=3-Math.trunc(e.length/4);return e+"\t".repeat(t)}(e)+": "+t)).join("\n")}const d=u({files:e,folders:t,symlinks:n}),p=u({charDevs:s,blockDevs:a,fifos:l,sockets:o}),f=u({total:r,platform:i,scanDate:z(c)});let v;return v="win32"!==i?[d,p,f].join("\n"):[d,f].join("\n"),console.log(v),v})),s=t((()=>{const e=[...ce.value,ue.value.root.name].join(ie.value);return e.startsWith("//")?e.slice(1):e})),a=t((()=>[...s.value].slice(0,-1).join(""))),l=t((()=>[...s.value].slice(-1).join(""))),r=t((()=>de.value.length-1&&"/"!==s.value));function i(){pe(ue.value.root)}return(e,t)=>(c(),u("span",ve,[d("span",{class:"parts",onClick:i,title:o(n)},[d("span",me,p(o(a)),1),d("span",ye,p(o(l)),1)],8,he),o(r)?(c(),u("span",ge,p(o(ie)),1)):f("",!0)]))},__scopeId:"data-v-48cc0cd2"};r("data-v-44b3de2e");const be={class:"opened-folder"},ke={class:"part"},_e={class:"part spaced"},De={key:0,class:"separator spaced"};i();const je={props:["index","count","entry"],setup(e){const n=e,{index:s,count:a,entry:l}=v(n),r=t((()=>s.value+1===a.value)),i=t((()=>[...l.value.name].slice(0,-1).join(""))),h=t((()=>[...l.value.name].slice(-1).join("")));function m(){pe(l.value)}return(e,t)=>(c(),u("span",be,[d("span",{class:"parts",onClick:m},[d("span",ke,p(o(i)),1),d("span",_e,p(o(h)),1)]),o(r)?f("",!0):(c(),u("span",De,p(o(ie)),1))]))},__scopeId:"data-v-44b3de2e"};r("data-v-f8be0ec4");const xe={class:"box"};i();const Ee={props:{maxWidth:{default:"max-content",type:String}},setup:e=>(t,n)=>(c(),u("div",xe,[d("div",{class:"sub",style:m({maxWidth:e.maxWidth})},[h(t.$slots,"default",{},void 0,!0)],4)])),__scopeId:"data-v-f8be0ec4"};r("data-v-55c28eea");const Te={class:"address"};i();const Ie={setup:e=>(e,t)=>(c(),u("div",Te,[y(Ee,null,{default:g((()=>[y(we)])),_:1}),(c(!0),u(w,null,b(o(de).slice(1),((e,t)=>(c(),k(Ee,null,{default:g((()=>[y(je,{entry:e,index:t,count:o(de).slice(1).length},null,8,["entry","index","count"])])),_:2},1024)))),256))])),__scopeId:"data-v-55c28eea"};r("data-v-a5a6c16c");const $e={class:"search"};i();const Se={setup:e=>(e,t)=>(c(),u("div",$e,[_(d("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>j(H)?H.value=e:null)},null,512),[[D,o(H)]]),d("button",{onClick:t[1]||(t[1]=(...e)=>o(K)&&o(K)(...e))},"Clear")])),__scopeId:"data-v-a5a6c16c"};r("data-v-23a29b76");const Ce={class:"file-select"},Me=x(" Select file "),ze=d("hr",null,null,-1);i();const Ne={setup(e){function t(e){return re(e.target.files[0])}return(e,n)=>(c(),u("div",Ce,[d("label",null,[Me,d("input",{type:"file",accept:"application/json,application/gzip",onChange:t},null,32)]),ze]))},__scopeId:"data-v-23a29b76"};r("data-v-4cf83322");const Be={class:"tabs"},Le=d("div",{class:"tab"},null,-1);i();const Oe={setup:e=>(e,t)=>(c(),u("div",Be,[y(Ne,{class:"tab"}),Le])),__scopeId:"data-v-4cf83322"};r("data-v-e9f0ab3e");const Pe=["title"],Fe={class:"icon"},Ue={class:"name"};i();const We={props:["entry"],setup(e){const n=v(e).entry,s=t((()=>n.value.hasErrors)),a=t((()=>n.value.hasErrors?JSON.stringify(n.value.errors[0],null," "):"symlink"===n.value.type?n.value.pathTo:void 0)),l=t((()=>"folder"===n.value.type?"📁":"file"===n.value.type?function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return C.includes(t)}(n.value.name)?"🎦":function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return M.includes(t)}(n.value.name)?"🖼":"📄":"symlink"===n.value.type?"🔗":"👾"));function r(e){"folder"===n.value.type?(console.log("openFolder",n.value),pe(n.value)):console.log(n.value)}function i(e){1===e.button&&(e.preventDefault(),console.log(n.value,[...le.value.path,...n.value.path.map((e=>e.name))].join(ie.value).replace("//","/")))}return(e,t)=>(c(),u("tr",{class:E(["row",{error:o(s)}]),onClick:r,onMousedown:i,title:o(a)},[d("td",Fe,p(o(l)),1),d("td",Ue,p(o(n).name),1)],42,Pe))},__scopeId:"data-v-e9f0ab3e"};r("data-v-47520d98");const qe={key:0,class:"rows"},Ae={key:1,class:"empty-message"},Re=[d("span",null,"The folder is empty.",-1)],Je={key:2,class:"error-message"},Ze=d("h2",null,"Error",-1),He=d("td",null,"syscall",-1),Ke=d("td",null,"code",-1),Ve=d("td",null,"errno",-1);i();const Ge={setup(e){const n=t((()=>!!ue.value.hasErrors&&ue.value.errors[0]));function s(e){e.preventDefault(),ue.value.parent&&pe(ue.value.parent)}return(e,t)=>(c(),u("div",{class:"content",onContextmenu:s},[o(F).length?(c(),u("table",qe,[(c(!0),u(w,null,b(o(F),(e=>(c(),k(We,{entry:e},null,8,["entry"])))),256))])):f("",!0),o(fe)&&!o(n)?(c(),u("div",Ae,Re)):f("",!0),o(n)?(c(),u("div",Je,[d("div",null,[Ze,d("table",null,[d("tr",null,[He,d("td",null,[d("pre",null,p(o(n).syscall),1)])]),d("tr",null,[Ke,d("td",null,[d("pre",null,p(o(n).code),1)])]),d("tr",null,[Ve,d("td",null,[d("pre",null,p(o(n).errno),1)])])])])])):f("",!0)],32))},__scopeId:"data-v-47520d98"},Ye={setup:e=>(e,t)=>(c(),u("div",null,"Item count: "+p(o(U)),1))},Qe={key:0},Xe={key:1},et={setup:e=>(e,t)=>o(W)?(c(),u("span",Qe,p(o(W)),1)):(c(),u("span",Xe,"_"))};r("data-v-602ec060");const tt={class:"main"},nt=d("div",{style:{"grid-area":"switch"}},null,-1);i();const st={setup:e=>(T((async()=>{const e=new URL(location.href).searchParams.get("filepath");if(e){return re(await fetch(e))}})),(e,t)=>(c(),u("div",tt,[nt,y(Ie,{style:{"grid-area":"address"}}),y(Se,{style:{"grid-area":"search"}}),y(Oe,{style:{"grid-area":"tabs"}}),y(Ge,{style:{"grid-area":"content"}}),y(Ye,{style:{"grid-area":"status"}}),y(et,{style:{"grid-area":"debug"}})]))),__scopeId:"data-v-602ec060"};I({setup:e=>(e,t)=>(c(),k(st))}).mount("#app");
//# sourceMappingURL=index.js.map
