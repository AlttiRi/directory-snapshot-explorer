var e=Object.defineProperty,t=("undefined"!=typeof require&&require,(t,n,s)=>(((t,n,s)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s})(t,"symbol"!=typeof n?n+"":n,s),s));import{r as n,c as s,w as a,m as o,i as r,t as l,u as i,p as c,a as u,o as d,b as p,d as f,e as h,f as v,g as m,h as y,n as g,j as b,k as w,F as k,l as S,q as D,s as j,v as _,x,y as C,z as M,A as T,B as E}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&processPreload(e)})).observe(document,{childList:!0,subtree:!0})}function processPreload(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const I=globalThis.setImmediate||function(){const{port1:e,port2:t}=new MessageChannel,n=[];return e.onmessage=function(){n.shift()()},function(e){t.postMessage(null),n.push(e)}}();function sleep(e){return new Promise(void 0===e?e=>I(e):t=>setTimeout(t,e))}const P=["mp4","webm","mkv","avi"];const $=["png","jpg","jpeg","gif","tiff","webp"];function dateToDayDateString(e,t=!0){const n=new Date(e);function pad(e){return e.toString().padStart(2,"0")}const s=t?"UTC":"",a=n[`get${s}FullYear`](),o=n[`get${s}Month`]()+1,r=n[`get${s}Date`]();return 0===Number(n)?(console.warn("date is 1970.01.01"),""):a+"."+pad(o)+"."+pad(r)}const N=n(!0),{compare:F}=new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"});function comparator(e,t){return N.value?F(e.name,t.name):0}const O=s((()=>[...Y.value.folders.sort(comparator),...Y.value.files.sort(comparator),...Y.value.symlinks.sort(comparator),...Y.value.fifos.sort(comparator),...Y.value.charDevs.sort(comparator),...Y.value.blockDevs.sort(comparator),...Y.value.sockets.sort(comparator)])),Z=s((()=>B.value.length?G.value:O.value)),J=s((()=>Z.value.slice(0,1e3))),L=s((()=>G.value.length>1e3?G.value.length:Z.value.length)),R=n("");function addMessage(e){R.value=e}function appendMessage(e){R.value+=e}const z=["folder","file","symlink","fifo","charDev","blockDev","socket"];class SimpleEntry{constructor(e,t){this.name=e.name,this.parent=t,this.type=e.type,e.size&&(this._size=e.size),e.mtime&&(this.mtime=e.mtime),e.btime&&(this.btime=e.btime),e.errors&&(this.errors=e.errors),e.pathTo&&(this.pathTo=e.pathTo),e.content&&(this.content=e.content)}addChild(e){this.children||(this.children=[]),this.children.push(e)}addHardlinks(e,t){this.hardlinks=e,this.hardlinksTotal=t}get size(){return"folder"===this.type?-0:this._size||0}get folders(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"folder"===e.type)))||[]}get files(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"file"===e.type)))||[]}get symlinks(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"symlink"===e.type)))||[]}get fifos(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"fifo"===e.type)))||[]}get charDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"charDev"===e.type)))||[]}get blockDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"blockDev"===e.type)))||[]}get sockets(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"socket"===e.type)))||[]}get isEmpty(){var e;return!Boolean(null==(e=this.children)?void 0:e.length)}get hasErrors(){var e;return Boolean(null==(e=this.errors)?void 0:e.length)}get root(){return this.parent?this.parent.root:this}get path(){return this.parent?[...this.parent.path,this]:[this]}}async function parseFlatScan(e){var t;const n=new Map,s=new Map;let a=0,o=Date.now();for(const r of e){if(!(a++%1e3)){const e=Date.now();e-o>15&&(o=e,await sleep())}const e=null!=(t=n.get(r.pid))?t:null,l=new SimpleEntry(r,e);if("folder"===r.type&&n.set(r.id,l),null==e||e.addChild(l),r.hid){const e=s.get(r.hid)||[];s.set(r.hid,[...e,l])}}return console.log("[hidMap]:",s),console.time("hidMap"),async function(e){let t=0,n=0;for(const[s,a]of e.entries()){if(!(t++%1e3)){const e=Date.now();e-n>15&&(n=e,await sleep())}const e=Number(s.split(":")[1]);a.forEach((t=>{t.addHardlinks(a,e)}))}}(s).then((()=>console.timeEnd("hidMap"))),n.get(0)}const A=new SimpleEntry({type:"folder",name:"",pid:null},null),B=n("");function clearSearch(){B.value=""}const G=n([]);function setSearchResult(e){G.value=o(e),console.log("globalThis.search:",globalThis.search=e),Object.defineProperty(globalThis.search,"download",{get(){console.log("download")}})}const W=function(e,t=50){let n;return function(){n&&clearTimeout(n),n=setTimeout((()=>{e.apply(this,arguments),n=null}),t)}}(performSearch,300);async function performSearch(){const e=Y.value,t=B.value,n=r(e)?l(e):e,s=performance.now(),a=await async function(e,t){var n;if(!t.startsWith("/"))return findAll(e,(e=>e.name.includes(t)));{const{type:s,word:a}=(null==(n=t.match(/\/type:(?<type>[^\/]+)\/?(?<word>[^\/]*)/))?void 0:n.groups)||{};if(s&&(console.log({type:s,word:a}),z.includes(s)))return findAll(e,(e=>e.type===s&&e.name.includes(a)))}return!1}(n,t);if(!a)return;addMessage(`Search time: ${(performance.now()-s).toFixed(2)} ms; `),await sleep();const o=performance.now(),i=a.sort(comparator);appendMessage(`Sort time: ${(performance.now()-o).toFixed(2)} ms; `),await sleep(),setSearchResult(i),appendMessage(`${a.length} items; search: ${t}`)}async function findAll(e,t){let n=[],s=Date.now();for(const a of function*(e){const t=1e3;let n=[];function*takePart(e){for(const s of e.children||[])"folder"===s.type&&(yield*takePart(s)),n.push(s),n.length===t&&(yield n,n=[])}yield*takePart(e),yield n}(e)){const e=Date.now();e-s>15&&(s=e,await sleep());for(const s of a)t(s)&&n.push(s)}return n}a(B,(async(e,t)=>{e?e.length-t.length>1?await performSearch():await W():setSearchResult([])}));let q=!1;async function loadPako(){if(!q){const e="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako_inflate.min.js",t="sha256-ZIKs3+RZEULSy0dR6c/mke8V9unZm9vuh05TqvtMdGU=";await function(e,t){return new Promise((n=>{const s=document.createElement("script");s.onload=n,s.src=e,s.setAttribute("async",""),t&&(s.integrity=t,s.setAttribute("crossorigin","anonymous")),document.querySelector("body").append(s)}))}(e,t),q=!0,console.log("pako is loaded")}}function*unZipIterator(e){const t=new pako.Inflate;for(const n of function*(e,t=65536){const n=new Uint8Array(e);let s=0;for(;;){const e=n.subarray(s,s+t);if(!e.length)break;yield e,s+=t}}(e,32768)){t.push(n);for(const e of t.chunks)yield e;t.chunks=[]}yield t.result,t.err&&console.error(t.msg)}async function unGZipJSON(e){await loadPako();const t=await e.arrayBuffer(),n=new TextDecoder;let s=[];const a=new Parser;let o=0,r=0;for(const l of unZipIterator(t)){if(!(o++%20)){const e=Date.now();e-r>15&&(r=e,await sleep())}const e=n.decode(l,{stream:!0});s.push(a.parse(e))}return s.flat()}class Parser{constructor(){t(this,"buffer",null),t(this,"startHandled",!1),t(this,"metaLines",[]),t(this,"objects",[])}handleStart(e){if("["!==e)return""===e?(this.objects.push(this.metaLines.join("")),void(this.startHandled=!0)):void this.metaLines.push(e)}trimComma(e){return e.endsWith(",")?e.slice(0,-1):e}handleEntry(e,t){t?this.buffer=e:this.buffer?(this.objects.push(this.buffer+e),this.buffer=null):this.objects.push(e)}parse(e){const t=e.endsWith("\n]"),n=e.split("\n");for(let a=0;a<n.length;a++){const e=n[a],s=a===n.length-1;s&&t||(this.startHandled?this.handleEntry(e,s):this.handleStart(e,s))}const s=JSON.parse(`[${this.trimComma(this.objects.join(""))}]`);return this.objects=[],s}}function isGZip(e){return Boolean(e.match(/^application\/.*?gzip/))}function isJSON(e){return Boolean(e.match(/^application\/.*?json/))}const U=n(null),H=n(null);async function setScan(e){const{meta:t,root:n}=await async function(e){let t;if(console.time("parse-json"),e instanceof Response){const n=e,s=n.headers.get("content-type");isGZip(s)?t=await unGZipJSON(n):isJSON(s)&&(t=await n.json())}else if(e instanceof Blob){const n=e;isGZip(n.type)?t=await unGZipJSON(n):isJSON(n.type)&&(t=JSON.parse(await n.text()))}console.timeEnd("parse-json");const n=t[0],s=t.slice(1);console.time("parseEntries");const a=await parseFlatScan(s);return console.timeEnd("parseEntries"),{meta:n,root:a}}(e);U.value=o(t),H.value=o(n),globalThis.json=n,openFolder(n),clearSearch()}const K=s((()=>{var e;return(null==(e=U.value)?void 0:e.separator)||"/"})),V=s((()=>{var e;return(null==(e=U.value)?void 0:e.path)||[]})),Y=n(A),Q=s((()=>Y.value.path));function openFolder(e){clearSearch(),Y.value=o(i(e))}const X=s((()=>H.value&&Y.value.isEmpty));a(U,(async(e,t)=>{console.log("[meta]:",U.value);const{files:n,folders:s,symlinks:a,errors:o,total:r,scanDate:l}=U.value;U.value.scanDate&&addMessage(`files: "${n}" folders: "${s}", symlinks: "${a}", errors: "${o}", total: "${r}", scanDate: "${dateToDayDateString(l)}"`)}));c("data-v-48cc0cd2");const ee={class:"scanPath"},te=["title"],ne={class:"part"},se={class:"part spaced"},ae={key:0,class:"spaced separator"};u();const oe={setup(e){const t=s((()=>{if(!U.value)return;const{files:e,folders:t,symlinks:n,charDevs:s,blockDevs:a,fifos:o,sockets:r,total:l,platform:i,scanDate:c}=U.value;function doString(e){return Object.entries(e).map((([e,t])=>function(e){const t=3-Math.trunc(e.length/4);return e+"\t".repeat(t)}(e)+": "+t)).join("\n")}const u=doString({files:e,folders:t,symlinks:n}),d=doString({charDevs:s,blockDevs:a,fifos:o,sockets:r}),p=doString({total:l,platform:i,scanDate:dateToDayDateString(c)});let f;return f="win32"!==i?[u,d,p].join("\n"):[u,p].join("\n"),console.log(f),f})),n=s((()=>{const e=[...V.value,Y.value.root.name].join(K.value);return e.startsWith("//")?e.slice(1):e})),a=s((()=>[...n.value].slice(0,-1).join(""))),o=s((()=>[...n.value].slice(-1).join(""))),r=s((()=>Q.value.length-1&&"/"!==n.value));function goToRoot(){openFolder(Y.value.root)}return(e,n)=>(d(),p("span",ee,[f("span",{class:"parts",onClick:goToRoot,title:i(t)},[f("span",ne,h(i(a)),1),f("span",se,h(i(o)),1)],8,te),i(r)?(d(),p("span",ae,h(i(K)),1)):v("",!0)]))},__scopeId:"data-v-48cc0cd2"};c("data-v-44b3de2e");const re={class:"opened-folder"},le={class:"part"},ie={class:"part spaced"},ce={key:0,class:"separator spaced"};u();const ue={props:["index","count","entry"],setup(e){const t=e,{index:n,count:a,entry:o}=m(t),r=s((()=>n.value+1===a.value)),l=s((()=>[...o.value.name].slice(0,-1).join(""))),c=s((()=>[...o.value.name].slice(-1).join("")));function onClick(){openFolder(o.value)}return(e,t)=>(d(),p("span",re,[f("span",{class:"parts",onClick:onClick},[f("span",le,h(i(l)),1),f("span",ie,h(i(c)),1)]),i(r)?v("",!0):(d(),p("span",ce,h(i(K)),1))]))},__scopeId:"data-v-44b3de2e"};c("data-v-f8be0ec4");const de={class:"box"};u();const pe={props:{maxWidth:{default:"max-content",type:String}},setup:e=>(t,n)=>(d(),p("div",de,[f("div",{class:"sub",style:g({maxWidth:e.maxWidth})},[y(t.$slots,"default",{},void 0,!0)],4)])),__scopeId:"data-v-f8be0ec4"};c("data-v-55c28eea");const fe={class:"address"};u();const he={setup:e=>(e,t)=>(d(),p("div",fe,[b(pe,null,{default:w((()=>[b(oe)])),_:1}),(d(!0),p(k,null,S(i(Q).slice(1),((e,t)=>(d(),D(pe,null,{default:w((()=>[b(ue,{entry:e,index:t,count:i(Q).slice(1).length},null,8,["entry","index","count"])])),_:2},1024)))),256))])),__scopeId:"data-v-55c28eea"};c("data-v-35dc98f8");const ve={class:"search"};u();const me={setup:e=>(e,t)=>(d(),p("div",ve,[f("label",null,[j(f("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>x(B)?B.value=e:null)},null,512),[[_,i(B)]])]),f("button",{onClick:t[1]||(t[1]=(...e)=>i(clearSearch)&&i(clearSearch)(...e))},"Clear")])),__scopeId:"data-v-35dc98f8"};c("data-v-23a29b76");const ye={class:"file-select"},ge=C(" Select file "),be=f("hr",null,null,-1);u();const we={setup(e){function onChange(e){return setScan(e.target.files[0])}return(e,t)=>(d(),p("div",ye,[f("label",null,[ge,f("input",{type:"file",accept:"application/json,application/gzip",onChange:onChange},null,32)]),be]))},__scopeId:"data-v-23a29b76"};c("data-v-4cf83322");const ke={class:"tabs"},Se=f("div",{class:"tab"},null,-1);u();const De={setup:e=>(e,t)=>(d(),p("div",ke,[b(we,{class:"tab"}),Se])),__scopeId:"data-v-4cf83322"};c("data-v-e9f0ab3e");const je=["title"],_e={class:"icon"},xe={class:"name"};u();const Ce={props:["entry"],setup(e){const t=m(e).entry,n=s((()=>t.value.hasErrors)),a=s((()=>t.value.hasErrors?JSON.stringify(t.value.errors[0],null," "):"symlink"===t.value.type?t.value.pathTo:void 0)),o=s((()=>"folder"===t.value.type?"📁":"file"===t.value.type?function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return P.includes(t)}(t.value.name)?"🎦":function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return $.includes(t)}(t.value.name)?"🖼":"📄":"symlink"===t.value.type?"🔗":"👾"));function onClick(e){"folder"===t.value.type?(console.log("openFolder",t.value),openFolder(t.value)):console.log(t.value)}function onMousedown(e){1===e.button&&(e.preventDefault(),console.log(t.value,[...U.value.path,...t.value.path.map((e=>e.name))].join(K.value).replace("//","/")))}return(e,s)=>(d(),p("tr",{class:M(["row",{error:i(n)}]),onClick:onClick,onMousedown:onMousedown,title:i(a)},[f("td",_e,h(i(o)),1),f("td",xe,h(i(t).name),1)],42,je))},__scopeId:"data-v-e9f0ab3e"};c("data-v-47520d98");const Me={key:0,class:"rows"},Te={key:1,class:"empty-message"},Ee=[f("span",null,"The folder is empty.",-1)],Ie={key:2,class:"error-message"},Pe=f("h2",null,"Error",-1),$e=f("td",null,"syscall",-1),Ne=f("td",null,"code",-1),Fe=f("td",null,"errno",-1);u();const Oe={setup(e){const t=s((()=>!!Y.value.hasErrors&&Y.value.errors[0]));function onContextMenu(e){e.preventDefault(),Y.value.parent&&openFolder(Y.value.parent)}return(e,n)=>(d(),p("div",{class:"content",onContextmenu:onContextMenu},[i(J).length?(d(),p("table",Me,[(d(!0),p(k,null,S(i(J),(e=>(d(),D(Ce,{entry:e},null,8,["entry"])))),256))])):v("",!0),i(X)&&!i(t)?(d(),p("div",Te,Ee)):v("",!0),i(t)?(d(),p("div",Ie,[f("div",null,[Pe,f("table",null,[f("tr",null,[$e,f("td",null,[f("pre",null,h(i(t).syscall),1)])]),f("tr",null,[Ne,f("td",null,[f("pre",null,h(i(t).code),1)])]),f("tr",null,[Fe,f("td",null,[f("pre",null,h(i(t).errno),1)])])])])])):v("",!0)],32))},__scopeId:"data-v-47520d98"},Ze={setup:e=>(e,t)=>(d(),p("div",null,"Item count: "+h(i(L)),1))},Je={key:0},Le={key:1},Re={setup:e=>(e,t)=>i(R)?(d(),p("span",Je,h(i(R)),1)):(d(),p("span",Le,"_"))};c("data-v-602ec060");const ze={class:"main"},Ae=f("div",{style:{"grid-area":"switch"}},null,-1);u();const Be={setup:e=>(T((async()=>{const e=new URL(location.href).searchParams.get("filepath");if(e){return setScan(await fetch(e))}})),(e,t)=>(d(),p("div",ze,[Ae,b(he,{style:{"grid-area":"address"}}),b(me,{style:{"grid-area":"search"}}),b(De,{style:{"grid-area":"tabs"}}),b(Oe,{style:{"grid-area":"content"}}),b(Ze,{style:{"grid-area":"status"}}),b(Re,{style:{"grid-area":"debug"}})]))),__scopeId:"data-v-602ec060"};E({setup:e=>(e,t)=>(d(),D(Be))}).mount("#app");
//# sourceMappingURL=index.js.map
